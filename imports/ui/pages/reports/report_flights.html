<template name="report_flights">
  <div class="events-guests">
    <div class="row">
      <div class="col s12">
        <h5 class="page-title">Guest Flights Master Report</h5>
      </div>

      {{#if getGuestCount}}

      <ul class="pagination">
        <li>
          <a href="#" id="page-minus">
            <i class="material-icons">chevron_left</i>
          </a>
        </li>
        {{#each page in getPagination}}
        <li class="{{page.isActive}} page-no">
          <a href="#" id="{{page.pageNo}}">{{indexPlusOne page.pageNo}}</a>
        </li>
        {{/each}}
        <li class="waves-effect">
          <a id="page-plus" href="#!">
            <i class="material-icons">chevron_right</i>
          </a>
        </li>
      </ul>
      {{/if}}
    </div>
    <!-- <div>
      <table>
        <tr>
          Total Guests: {{getGuestCount}} & Loggedin Guest:
          {{getLoggedInGuestCount}}
        </tr>
      </table>
    </div> -->
    {{#if Template.subscriptionsReady}} {{#if getGuestCount}}
    <div class="row">
      {{> report_flight_guest_list}}
    </div>
    {{else}}
    <div class="col s12">
      <br />
      <br />
      <h5 class="page-title">No Guests Found</h5>
      <br />
      <br />
    </div>
    {{/if}} {{else}}
    <div class="preloader-wrapper small active">
      <div class="spinner-layer spinner-green-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
    {{/if}}
  </div>
</template>

<template name="report_flight_guest_list">
  <div class="row">
    <!-- <div class="data-field col s3">
      <input
        id="startDate"
        type="text"
        class="datepicker dateFilter"
        name="startDate"
        value=""
      />
      <label for="startDate">Start Date</label>
    </div>
    <div class="date-field col s3">
      <input
        id="endDate"
        type="text"
        class="datepicker dateFilter"
        name="endDate"
        value=""
      />
      <label for="endDate">End Date</label>
    </div> -->
    <div class="col s12">
      <div class="guest-action">
        {{#if isAllowed 'guest-export'}}
        <a
          class="waves-effect waves-light btn btn-primary exportReport"
          href="#"
        >
          <i class="material-icons left">add</i>Export Data<i
            class="tooltip-icon"
            data-position="top"
            data-delay="50"
            data-tooltip="Download your report"
          ></i>
        </a>
        {{/if}}
      </div>
    </div>
  </div>
  <table class="flightReports">
    <thead>
      <tr>
        <th>#</th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="folioNumber"
            data-sortDirection="asc"
          >
            Folio No.
            <i
              class="tooltip-icon"
              data-position="top"
              data-delay="50"
              data-tooltip="Autogenerated from System"
            ></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestFirstName"
            data-sortDirection="asc"
          >
            Guest Name
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestIsPrimary"
            data-sortDirection="asc"
          >
            Is Primary
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestPersonalEmail"
            data-sortDirection="asc"
          >
            Email ID
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <th>Contact No.</th>
        {{#each noOflegs}}
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="agencyProvided"
            data-sortDirection="1"
          >
            Booking Type
          </a>
        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="airlineIATA"
            data-sortDirection="1"
          >
          IATA Code
        </a>

        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="flightNo"
            data-sortDirection="1"
          >
          Flight No
        </a>
        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="pnr"
            data-sortDirection="1"
          >
          PNR
        </a>
        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="departureCity"
            data-sortDirection="1"
          >
          Departure City
        </a>
        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="flightDepartureTime"
            data-sortDirection="1"
          >
          Departure Time
        </a>
        </th>
        <th>
            <a
            class="sort-data"
            href="#"
            data-sort="arrivalCity"
            data-sortDirection="1"
          >
          Arrival City
        </a>
        </th>
        <th>
          <a class="sort-data"
          href="#"
          data-sort="flightArrivalTime"
          data-sortDirection="1"
          >
          
          Arrival Time
        </a>
        </th>
        {{/each}}
      </tr>
    </thead>
    <tbody>
      {{#each guestList}} {{> report_flight_guest_item index=@index info=this}}
      {{/each}} {{> defaultBootstrapPaginator pagination=templatePagination
      limit=5 containerClass="text-center" onClick=clickEvent}}
    </tbody>
  </table>
</template>

<template name="report_flight_guest_item">
  <tr>
    <td>{{PageNumbers index}}</td>
    <td>
      {{padLeft info.folioNumber 5}}
    </td>
    <td>
      {{ info.guestTitle }} {{ info.guestFirstName }} {{ info.guestLastName }}
    </td>
    <td>{{#if info.guestIsPrimary}}Yes{{else}}No{{/if}}</td>
    <td>{{ info.guestPersonalEmail }}</td>
    <td>{{ info.guestPhoneCode }}-{{ info.guestContactNo }}</td>
    {{#each info.flights}} {{> guest_flight_summary index=@index flight=this}}
    {{/each}}
  </tr>
  <!-- {{#if hasGuestFamilyList}} {{#each guestFamilyList}}
        {{>report_guest_family info2=this index=@index}} {{/each}} {{/if}} -->
</template>

<template name="guest_flight_summary">
  {{#if flight.agencyProvided}}
  <td>Agency</td>
  {{else}}
  <td>Guest</td>
  {{/if}}
  <!-- <td>{{flight.pnrNumber}}</td> -->
  {{#each flight.flightLegs}} {{ >flightLeg index=@index leg=this}} {{/each}}
</template>

<template name="flightLeg">
  <td>{{leg.airlineIATA}}</td>
  <td>{{leg.flightNo}}</td>
  <td>{{leg.pnr}}</td>
  <!-- <td>{{getAirport(leg.flightDepartureCityId)}}</td> -->
  <td>{{leg.departureCity}}</td>
  <td>{{getDateTime(leg.flightDepartureTime)}}</td>
  <!-- <td>{{getAirport(leg.flightArrivalCityId)}}</td> -->
  <td>{{leg.arrivalCity}}</td>
  <td>{{getDateTime(leg.flightArrivalTime)}}</td>
</template>

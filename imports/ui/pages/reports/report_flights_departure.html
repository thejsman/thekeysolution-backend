<template name="report_flights_departure">
  <div class="events-guests">
    <div class="row">
      <div class="col s12">
        <h5 class="page-title">Guest Flights Departure Report</h5>
      </div>
    </div>

    {{#if Template.subscriptionsReady}} {{#if getGuestCount}}
    <div class="row">
      {{> report_flight_guest_list_departure}}
    </div>
    {{else}}
    <div class="col s12">
      <br />
      <br />
      <h5 class="page-title">No Guests Found</h5>
      <br />
      <br />
    </div>
    {{/if}} {{else}}
    <div class="preloader-wrapper small active">
      <div class="spinner-layer spinner-green-only">
        <div class="circle-clipper left">
          <div class="circle"></div>
        </div>
        <div class="gap-patch">
          <div class="circle"></div>
        </div>
        <div class="circle-clipper right">
          <div class="circle"></div>
        </div>
      </div>
    </div>
    {{/if}}
  </div>
</template>

<template name="report_flight_guest_list_departure">
  <div class="row">
    <form id="export-flights-form_departure">
      <div class="col s3">
        {{> datetimepicker id="start_date" type="text" name="start_date"
        label="Start Date and Time"}}
      </div>
      <div class="col s3">
        {{> datetimepicker id="end_date" type="text" name="end_date"
        label="EndDate and Time"}}
      </div>
      <div class="col s3">
        <div class="guest-action">
          {{#if isAllowed 'guest-export'}}
          <a
            class="waves-effect waves-light btn btn-primary searchReport"
            href="#"
          >
            <i class="material-icons left">add</i>Search Data<i
              class="tooltip-icon"
              data-position="top"
              data-delay="50"
              data-tooltip="Search arrival flights"
            ></i>
          </a>
          {{/if}}
        </div>
      </div>
      <div class="col s3">
        <div class="guest-action">
          {{#if isAllowed 'guest-export'}}
          <a
            class="waves-effect waves-light btn btn-primary exportReportDeparture"
            href="#"
          >
            <i class="material-icons left">add</i>Export Data<i
              class="tooltip-icon"
              data-position="top"
              data-delay="50"
              data-tooltip="Download your report"
            ></i>
          </a>
          {{/if}}
        </div>
      </div>
    </form>
  </div>
  <table class="reports flightReports">
    <thead>
      <tr>
        <th>#</th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="folioNumber"
            data-sortDirection="asc"
          >
            Folio No.
            <i
              class="tooltip-icon"
              data-position="top"
              data-delay="50"
              data-tooltip="Autogenerated from System"
            ></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestFirstName"
            data-sortDirection="asc"
          >
            Guest Name
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestIsPrimary"
            data-sortDirection="asc"
          >
            Is Primary
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <th>
          <a
            class="sort-data"
            href="#"
            data-sort="guestPersonalEmail"
            data-sortDirection="asc"
          >
            Email ID
            <i class="fa fa-sort"></i>
          </a>
        </th>
        <!-- {{#each getMaxLegs}} -->
        <th>Contact No.</th>
        {{#each noOflegs}}
        <th>Booking Type</th>
        <th>Airline Code</th>
        <th>Flight No</th>
        <th>PNR</th>
        <th>From</th>
        <th>Departure</th>
        <th>To</th>
        <th>Arrival</th>
        {{/each}}
      </tr>
    </thead>
    <tbody>
      {{#each guestList}} {{> report_flight_guest_item_departure index=@index
      info=this}} {{/each}} {{> defaultBootstrapPaginator
      pagination=templatePagination limit=5 containerClass="text-center"
      onClick=clickEvent}}
    </tbody>
  </table>
</template>

<template name="report_flight_guest_item_departure">
  <tr>
    <td>{{PageNumbers index}}</td>
    <td>
      {{padLeft info.folioNumber 5}}
    </td>
    <td>
      {{ info.guestTitle }} {{ info.guestFirstName }} {{ info.guestLastName }}
    </td>
    <td>{{#if info.guestIsPrimary}}Yes{{else}}No{{/if}}</td>
    <td>{{ info.guestPersonalEmail }}</td>
    <td>{{ info.guestPhoneCode }}-{{ info.guestContactNo }}</td>
    {{#each info.flights}} {{> guest_flight_summary_departure index=@index
    flight=this}} {{/each}}
  </tr>
  <!-- {{#if hasGuestFamilyList}} {{#each guestFamilyList}}
          {{>report_guest_family info2=this index=@index}} {{/each}} {{/if}} -->
</template>

<template name="guest_flight_summary_departure">
  {{#if flight.agencyProvided}}
  <td>Agency</td>
  {{else}}
  <td>Guest</td>
  {{/if}}
  <!-- <td>{{flight.pnrNumber}}</td> -->
  {{#each flight.flightLegs}} {{> flightLeg_departure index=@index leg=this}}
  {{/each}}
</template>

<template name="flightLeg_departure">
  <td>{{leg.airlineIATA}}</td>
  <td>{{leg.flightNo}}</td>
  <td>{{leg.pnr}}</td>
  <td>{{getAirport(leg.flightDepartureCityId)}}</td>
  <td>{{getDateTime(leg.flightDepartureTime)}}</td>
  <td>{{getAirport(leg.flightArrivalCityId)}}</td>
  <td>{{getDateTime(leg.flightArrivalTime)}}</td>
</template>
